<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WHOIS 查詢 - 實用小工具集</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap");
        body { font-family: "Inter", sans-serif; }
    </style>
</head>
<body class="bg-white text-gray-900 min-h-screen antialiased flex flex-col">
    <nav class="border-b border-gray-100 flex-none">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <div class="flex items-center gap-2">
                    <a href="index.html" class="w-8 h-8 bg-black rounded-lg flex items-center justify-center hover:opacity-80 transition-opacity">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>
                    </a>
                    <span class="text-xl font-bold tracking-tight">WHOIS 查詢</span>
                </div>
                <button onclick="copyResult()" class="text-sm font-semibold border border-gray-200 px-4 py-2 rounded-lg hover:border-black hover:bg-black hover:text-white transition-all">
                    複製結果
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-6 lg:px-8 py-10 w-full flex-grow flex flex-col gap-8">

        <!-- Search Box -->
        <div class="space-y-4">
            <label class="block text-xs font-bold text-gray-400 uppercase tracking-widest">域名查詢</label>
            <div class="flex gap-2">
                <input type="text" id="domain-input" class="flex-grow p-4 bg-gray-50 border-2 border-transparent focus:bg-white focus:border-black outline-none rounded-xl transition-all" placeholder="輸入域名，例如: example.com" onkeypress="if(event.key==='Enter') performLookup()">
                <button onclick="performLookup()" class="px-8 py-4 bg-black text-white rounded-xl font-semibold hover:opacity-90 transition-all">
                    查詢
                </button>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading" class="hidden text-center py-12">
            <div class="inline-block w-8 h-8 border-4 border-gray-200 border-t-black rounded-full animate-spin"></div>
            <p class="mt-4 text-gray-500">查詢中...</p>
        </div>

        <!-- Results -->
        <div id="results" class="hidden space-y-6">
            <!-- Basic Info -->
            <div class="border border-gray-200 rounded-xl p-6">
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">基本資訊</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <div class="text-sm text-gray-500 mb-1">域名</div>
                        <div class="font-semibold" id="result-domain">-</div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-500 mb-1">註冊商</div>
                        <div class="font-semibold" id="result-registrar">-</div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-500 mb-1">註冊日期</div>
                        <div class="font-semibold" id="result-created">-</div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-500 mb-1">到期日期</div>
                        <div class="font-semibold" id="result-expires">-</div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-500 mb-1">更新日期</div>
                        <div class="font-semibold" id="result-updated">-</div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-500 mb-1">狀態</div>
                        <div class="font-semibold" id="result-status">-</div>
                    </div>
                </div>
            </div>

            <!-- Name Servers -->
            <div class="border border-gray-200 rounded-xl p-6">
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">名稱伺服器</h3>
                <div id="result-nameservers" class="space-y-2 font-mono text-sm">
                    -
                </div>
            </div>

            <!-- Raw Data -->
            <div class="border border-gray-200 rounded-xl p-6">
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">完整資料</h3>
                <pre id="result-raw" class="bg-gray-50 p-4 rounded-lg overflow-x-auto text-xs font-mono whitespace-pre-wrap">查詢結果將顯示在這裡</pre>
            </div>
        </div>

        <!-- Error Message -->
        <div id="error" class="hidden border border-red-200 bg-red-50 rounded-xl p-6">
            <h3 class="font-bold text-red-900 mb-2">查詢失敗</h3>
            <p class="text-red-700" id="error-message"></p>
        </div>

        <!-- Examples -->
        <div class="pt-8 border-t border-gray-100">
            <label class="block text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">範例域名</label>
            <div class="flex flex-wrap gap-2">
                <button onclick="loadExample('google.com')" class="px-4 py-2 border border-gray-200 rounded-lg hover:border-black transition-all text-sm">google.com</button>
                <button onclick="loadExample('github.com')" class="px-4 py-2 border border-gray-200 rounded-lg hover:border-black transition-all text-sm">github.com</button>
                <button onclick="loadExample('wikipedia.org')" class="px-4 py-2 border border-gray-200 rounded-lg hover:border-black transition-all text-sm">wikipedia.org</button>
            </div>
        </div>

    </main>

    <script>
        function performLookup() {
            const domain = document.getElementById("domain-input").value.trim();
            if (!domain) {
                showError("請輸入域名");
                return;
            }

            // Clean domain
            const cleanDomain = domain.replace(/^https?:\/\//, '').replace(/\/.*$/, '');

            // Hide previous results
            document.getElementById("results").classList.add("hidden");
            document.getElementById("error").classList.add("hidden");
            document.getElementById("loading").classList.remove("hidden");

            // Try multiple RDAP servers for better reliability
            const rdapServers = [
                `https://rdap.verisign.com/com/v1/domain/${cleanDomain}`,
                `https://rdap.org/domain/${cleanDomain}`,
                `https://rdap.nic.${cleanDomain.split('.').pop()}/domain/${cleanDomain}`
            ];

            tryRdapServers(rdapServers, 0, cleanDomain);
        }

        async function tryRdapServers(servers, index, domain) {
            if (index >= servers.length) {
                document.getElementById("loading").classList.add("hidden");
                showError("所有查詢服務均無法使用。請稍後再試，或使用命令列工具: whois " + domain);
                return;
            }

            try {
                const response = await fetch(servers[index]);
                if (!response.ok) {
                    throw new Error("Server unavailable");
                }
                const data = await response.json();
                document.getElementById("loading").classList.add("hidden");
                displayResults(data, domain);
            } catch (error) {
                // Try next server
                tryRdapServers(servers, index + 1, domain);
            }
        }

        function displayResults(data, domain) {
            document.getElementById("results").classList.remove("hidden");

            // Parse RDAP response
            document.getElementById("result-domain").textContent = data.ldhName || domain;

            // Find registrar from entities
            const registrarEntity = (data.entities || []).find(e =>
                e.roles && e.roles.includes("registrar")
            );
            document.getElementById("result-registrar").textContent =
                registrarEntity?.vcardArray?.[1]?.find(v => v[0] === "fn")?.[3] || "資訊不可用";

            // Parse events
            const events = data.events || [];
            const registrationEvent = events.find(e => e.eventAction === "registration");
            const expirationEvent = events.find(e => e.eventAction === "expiration");
            const lastChangedEvent = events.find(e => e.eventAction === "last changed");

            document.getElementById("result-created").textContent =
                registrationEvent ? new Date(registrationEvent.eventDate).toLocaleString('zh-TW') : "資訊不可用";
            document.getElementById("result-expires").textContent =
                expirationEvent ? new Date(expirationEvent.eventDate).toLocaleString('zh-TW') : "資訊不可用";
            document.getElementById("result-updated").textContent =
                lastChangedEvent ? new Date(lastChangedEvent.eventDate).toLocaleString('zh-TW') : "資訊不可用";

            // Status
            const status = (data.status || []).join(", ") || "資訊不可用";
            document.getElementById("result-status").textContent = status;

            // Name servers
            const nsContainer = document.getElementById("result-nameservers");
            if (data.nameservers && data.nameservers.length > 0) {
                nsContainer.innerHTML = data.nameservers
                    .map(ns => `<div class="text-gray-700">${ns.ldhName || ns.objectClassName}</div>`)
                    .join("");
            } else {
                nsContainer.innerHTML = "資訊不可用";
            }

            // Raw data
            document.getElementById("result-raw").textContent = JSON.stringify(data, null, 2);
        }

        function showError(message) {
            document.getElementById("error").classList.remove("hidden");
            document.getElementById("error-message").textContent = message;
        }

        function loadExample(domain) {
            document.getElementById("domain-input").value = domain;
            performLookup();
        }

        function copyResult() {
            const raw = document.getElementById("result-raw").textContent;
            if (raw && raw !== "查詢結果將顯示在這裡") {
                navigator.clipboard.writeText(raw).then(() => {
                    const btn = event.target;
                    const originalText = btn.textContent;
                    btn.textContent = "已複製！";
                    setTimeout(() => btn.textContent = originalText, 2000);
                });
            }
        }
    </script>
</body>
</html>
